<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="RLIRL.App.Views.GamePage"
             xmlns:vm="clr-namespace:RLIRL.App.ViewModels"
             x:DataType="vm:GameViewModel"
             Title="GamePage">
    <Grid BackgroundColor="LightSkyBlue">
        <!-- HUD + Commandes -->
        <Grid Padding="16"
              RowDefinitions="Auto,*,Auto"
              ColumnDefinitions="*,*">

            <!-- HUD (score/chrono/connexion) -->
            <HorizontalStackLayout Grid.Row="0" Grid.ColumnSpan="2" Spacing="24">
                <Label Text="0 - 0" FontAttributes="Bold" FontSize="20"/> <!--Text="{Binding ScoreText}"-->
                <Label Text="5:00" FontSize="20"/> <!--Text="{Binding TimeLeft}"-->
                <Label Text="Connection info" /> <!--Text="{Binding ConnectionInfo}"-->
            </HorizontalStackLayout>

            <!-- Zone commandes -->
            <Grid Grid.Row="1" Grid.ColumnSpan="2">
                <!-- Joystick gauche -->
                <AbsoluteLayout x:Name="JoyArea"
                                HorizontalOptions="Start"
                                VerticalOptions="End"
                                Margin="20"
                                HeightRequest="160" WidthRequest="160">

                    <!-- base -->
                    <Frame
                        AbsoluteLayout.LayoutBounds=".5,.5,140,140"
                        AbsoluteLayout.LayoutFlags="PositionProportional"
                        BackgroundColor="#22222288"
                        CornerRadius="90"
                        HasShadow="True" />

                    <!-- knob -->
                    <Frame x:Name="JoyKnob"
                           AbsoluteLayout.LayoutBounds=".5,.5,64,64"
                           AbsoluteLayout.LayoutFlags="PositionProportional"
                           BackgroundColor="#0097A7"
                           CornerRadius="32"
                           HasShadow="True">
                        <Frame.GestureRecognizers>
                            <PanGestureRecognizer PanUpdated="OnJoystickPanUpdated"/>
                        </Frame.GestureRecognizers>
                    </Frame>
                </AbsoluteLayout>

                <!-- Commandes droite -->
                <VerticalStackLayout
                    HorizontalOptions="End"
                    VerticalOptions="End"
                    Margin="20"
                    Spacing="16">

                    <!-- Speed + jauge boost -->
                    <Grid ColumnDefinitions="Auto,Auto" ColumnSpacing="16" HorizontalOptions="End">
                        <!-- Jauge boost (verticale via Rotation) -->
                        <ProgressBar WidthRequest="18" HeightRequest="120"
                                     Rotation="270"
                                     Progress="{Binding Boost}" 
                                     VerticalOptions="Center" />

                        <!-- Bouton Speed avec drag vers le haut = boost -->
                        <Button x:Name="SpeedButton"
                                Text="Speed up"
                                WidthRequest="110" HeightRequest="110"
                                CornerRadius="55"
                                FontAttributes="Bold"
                                BackgroundColor="#EEEEEEAA"
                                Pressed="OnSpeedPressed"
                                Released="OnSpeedReleased">
                            <Button.GestureRecognizers>
                                <PanGestureRecognizer PanUpdated="OnSpeedPanUpdated"/>
                            </Button.GestureRecognizers>
                            <Button.Triggers>
                                <!-- effet visuel quand boost actif -->
                                <DataTrigger TargetType="Button"
                                             Binding="{Binding IsBoosting}"
                                             Value="True">
                                    <Setter Property="BackgroundColor" Value="#00E676AA"/>
                                    <Setter Property="Scale" Value="1.05"/>
                                </DataTrigger>
                            </Button.Triggers>
                        </Button>
                    </Grid>

                    <!-- Brake -->
                    <Button Text="Brake"
                            WidthRequest="110" HeightRequest="110"
                            CornerRadius="55"
                            FontAttributes="Bold"
                            BackgroundColor="#EEEEEEAA"
                            Pressed="OnBrakePressed"
                            Released="OnBrakeReleased"/>
                </VerticalStackLayout>
            </Grid>
        </Grid>
    </Grid>
</ContentPage>