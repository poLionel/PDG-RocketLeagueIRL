<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="RLIRL.App.Views.GamePage"
             xmlns:vm="clr-namespace:RLIRL.App.ViewModels"
             x:DataType="vm:GameViewModel">
    <Grid Style="{StaticResource GameBackground}">
        <!-- HUD + Commandes -->
        <Grid Style="{StaticResource GameContainer}"
              RowDefinitions="Auto,*"
              ColumnDefinitions="*,*">

            <!-- HUD (score/chrono/connexion) -->
            <HorizontalStackLayout Grid.Row="0" Grid.ColumnSpan="2" Style="{StaticResource HudContainer}">
                <Label Text="0" Style="{StaticResource HudScoreBlue}"/>
                <Label Text="5:00" Style="{StaticResource HudTimer}"/>
                <Label Text="0" Style="{StaticResource HudScoreOrange}"/>
            </HorizontalStackLayout>

            <!-- Zone commandes -->
            <Grid Grid.Row="1" Grid.ColumnSpan="2">
                <!-- Joystick gauche -->
                <AbsoluteLayout x:Name="JoyArea" Style="{StaticResource JoystickArea}">

                    <!-- base -->
                    <Frame
                        AbsoluteLayout.LayoutBounds=".5,.5,140,140"
                        AbsoluteLayout.LayoutFlags="PositionProportional"
                        Style="{StaticResource JoystickBase}" />

                    <!-- knob -->
                    <Frame x:Name="JoyKnob"
                           AbsoluteLayout.LayoutBounds=".5,.5,64,64"
                           AbsoluteLayout.LayoutFlags="PositionProportional"
                           Style="{StaticResource JoystickKnob}">
                        <Frame.GestureRecognizers>
                            <PanGestureRecognizer PanUpdated="OnJoystickPanUpdated"/>
                        </Frame.GestureRecognizers>
                    </Frame>
                </AbsoluteLayout>

                <!-- Commandes droite -->
                <VerticalStackLayout Style="{StaticResource GameControlsContainer}">

                    <!-- Speed + jauge boost -->
                    <Grid ColumnDefinitions="Auto,Auto" ColumnSpacing="16" Style="{StaticResource SpeedControlsGrid}">
                        <!-- Jauge boost (verticale via Rotation) -->
                        <ProgressBar Style="{StaticResource BoostBar}"
                                     Progress="{Binding Boost}" />

                        <!-- Bouton Speed avec drag vers le haut = boost -->
                        <Button x:Name="SpeedButton"
                                Style="{StaticResource SpeedButton}"
                                Pressed="OnSpeedPressed"
                                Released="OnSpeedReleased">
                            <Button.GestureRecognizers>
                                <PanGestureRecognizer PanUpdated="OnSpeedPanUpdated"/>
                            </Button.GestureRecognizers>
                            <Button.Triggers>
                                <!-- effet visuel quand boost actif -->
                                <DataTrigger TargetType="Button"
                                             Binding="{Binding IsBoosting}"
                                             Value="True">
                                    <Setter Property="BackgroundColor" Value="#00E676AA"/>
                                    <Setter Property="Scale" Value="1.05"/>
                                </DataTrigger>
                            </Button.Triggers>
                        </Button>
                    </Grid>

                    <!-- Brake -->
                    <Button Style="{StaticResource BrakeButton}"
                            Pressed="OnBrakePressed"
                            Released="OnBrakeReleased"/>
                </VerticalStackLayout>
            </Grid>
        </Grid>
    </Grid>
</ContentPage>